<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday Nikitha ‚Äî The Strong Woman üå∏</title>
<style>
  :root{
    --bg1:#FFF7FB; --bg2:#F3FBFF; --accent:#d97be9; --muted:#6f5b78;
    --card:#ffffff; --gold:#ffd67a; --rose:#ffd6e6;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background:linear-gradient(135deg,var(--bg1),var(--bg2));}
  body{display:flex;align-items:center;justify-content:center;padding:18px;}

  .card{width:100%;max-width:980px;border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,0.96),rgba(255,255,255,0.92));
    box-shadow:0 20px 70px rgba(120,80,160,0.10);padding:20px;position:relative;overflow:hidden;min-height:460px;}

  .bg-motif{position:absolute;inset:0;pointer-events:none;z-index:0}
  .sun-planet{position:absolute;width:140px;height:140px;border-radius:50%;background:radial-gradient(circle at 35% 30%, rgba(255,220,140,0.95), rgba(255,200,100,0.08));right:14%;top:8%;filter:blur(22px);opacity:0.75}
  .strong-watermark{position:absolute;left:6%;top:12%;font-weight:800;font-size:120px;color:rgba(210,135,200,0.06);transform:rotate(-12deg);pointer-events:none;user-select:none}

  header{display:flex;align-items:center;gap:12px;margin-bottom:8px;z-index:2;position:relative}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#ffd6ee,#e7d7ff);display:flex;align-items:center;justify-content:center;font-weight:700;color:#6b3d70;flex-shrink:0}
  h1{margin:0;font-size:20px;color:#4a2b6e}
  p.lead{margin:2px 0 0;color:var(--muted);font-size:13px}

  .stage{margin-top:14px;border-radius:12px;padding:14px;min-height:300px;background:linear-gradient(180deg,rgba(255,255,255,0.82),rgba(255,255,255,0.78));
    display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;z-index:2}

  .car-wrap{width:100%;max-width:780px;height:260px;position:relative;display:flex;align-items:center;justify-content:center}
  svg#car{width:70%;height:auto;transition:opacity 900ms ease, transform 1.0s cubic-bezier(.22,.9,.25,1)}
  .title-overlay{position:absolute;top:18px;left:20px;right:20px;text-align:center;pointer-events:none;color:#42244c;font-weight:700;font-size:22px;opacity:0;transform:translateY(-6px);transition:opacity 1.0s ease, transform 1.0s ease;text-shadow:0 8px 20px rgba(150,120,200,0.06);z-index:3}

  .controls{margin-top:14px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;z-index:2}
  .btn{padding:12px 16px;border-radius:12px;border:0;background:linear-gradient(90deg,#fff,#fff7ff);cursor:pointer;font-weight:700;color:#4a2b6e;box-shadow:0 8px 20px rgba(140,100,200,0.06);font-size:16px}
  .primary{background:linear-gradient(90deg,#f4a1ff,#9aa7ff);color:white}
  .muted{background:linear-gradient(90deg,#ffffff,#fff9f0);color:#4a2b6e;border:1px solid rgba(120,80,160,0.06)}

  .messages{margin-top:16px;padding:16px;border-radius:12px;background:rgba(250,250,255,0.9);max-height:380px;overflow:auto;display:none;z-index:2}
  .line{opacity:0;transform:translateY(12px);transition:opacity 1000ms ease, transform 1000ms ease;margin:12px 0;color:#3b2250;font-size:17px;line-height:1.5}
  .line.visible{opacity:1;transform:translateY(0)}
  .small{font-size:13px;color:var(--muted)}
  .controls-in-messages{margin-top:12px;display:flex;gap:12px;flex-direction:column;align-items:stretch}

  textarea.wish{width:100%;min-height:120px;border-radius:10px;padding:10px;border:1px solid rgba(180,160,180,0.12);font-size:15px;resize:vertical}

  footer.small{font-size:13px;color:var(--muted);margin-top:12px;text-align:center;z-index:2}
  .fromPrag{margin-top:12px;text-align:center;color:#b86f9f;font-size:14px;opacity:0.95}

  .download-note{margin-top:14px;padding:12px;border-radius:10px;background:linear-gradient(90deg,rgba(255,250,245,0.95),rgba(255,255,255,0.95));border:1px solid rgba(220,200,230,0.6);text-align:center;color:#6b3d70;font-weight:600}
  .download-btn{margin-top:10px;padding:10px 16px;border-radius:10px;background:linear-gradient(90deg,#ffd67a,#ffb6c1);border:0;color:#5b2b6b;font-weight:800;cursor:pointer}

  .send-panel{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.98);border:1px solid rgba(230,210,240,0.6)}
  .send-row{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
  .send-input{flex:1;padding:8px 10px;border-radius:8px;border:1px solid rgba(200,180,200,0.12);font-size:14px}
  .send-text{width:100%;min-height:76px;border-radius:8px;padding:8px;border:1px solid rgba(200,180,200,0.12);margin-top:8px;font-size:14px}

  .send-actions{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
  .send-btn{padding:10px 12px;border-radius:8px;border:0;background:linear-gradient(90deg,#ffd6e6,#e7d7ff);color:#5b2b6b;font-weight:700;cursor:pointer}

  .sparkles{position:absolute;inset:0;pointer-events:none;z-index:1;overflow:hidden}
  .spark{position:absolute;width:6px;height:6px;border-radius:50%;background:rgba(255,210,150,0.9);box-shadow:0 0 8px rgba(255,215,140,0.6);opacity:0.9;transform:translateY(0);}

  @media (max-width:720px){
    .card{padding:14px;min-height:560px}
    .title-overlay{font-size:18px}
    .line{font-size:16px}
    .logo{width:48px;height:48px}
    svg#car{width:92%}
    .sun-planet{width:110px;height:110px;right:6%;top:6%;}
    .strong-watermark{font-size:72px;left:2%;top:8%}
    .controls{justify-content:center}
  }
</style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="title">
    <div class="bg-motif">
      <div class="sun-planet" aria-hidden="true"></div>
      <div class="strong-watermark" aria-hidden="true">STRONG</div>
    </div>

    <header>
      <div class="logo">N</div>
      <div style="z-index:2">
        <h1 id="title">Happy Birthday Nikitha ‚Äî The Strong Woman</h1>
        <p class="lead">Open, press <em>Start the Car</em>, and enjoy the surprise üéÅ</p>
      </div>
    </header>

    <section class="stage" id="stage">
      <div class="car-wrap" id="carWrap" aria-hidden="false">
        <div class="title-overlay" id="titleOverlay">Happy Birthday, Nikitha Cathryn üå∏</div>

        <svg id="car" viewBox="0 0 800 300" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Pink sports car" style="z-index:2">
          <ellipse cx="400" cy="250" rx="240" ry="28" fill="rgba(100,40,100,0.06)"/>
          <g id="carBody">
            <path d="M120 200 Q140 150 220 140 L540 140 Q600 140 640 170 L700 210 Q680 230 620 230 L200 230 Q160 230 120 200 Z" fill="#ffd6e6" stroke="#ffb6da" stroke-width="2"/>
            <path d="M260 140 Q320 110 420 110 Q500 110 540 140" fill="#eef6ff" stroke="#cfe8ff" stroke-width="2" />
            <g>
              <circle cx="250" cy="240" r="30" fill="#2b2b2b"/>
              <circle cx="250" cy="240" r="18" fill="#ffd6e6"/>
              <circle cx="570" cy="240" r="30" fill="#2b2b2b"/>
              <circle cx="570" cy="240" r="18" fill="#ffd6e6"/>
            </g>
          </g>
        </svg>
      </div>
    </section>

    <div class="controls" id="controlsArea">
      <button id="startCarBtn" class="primary btn">Start the Car üöóüí®</button>
      <button id="skipCarBtn" class="btn muted">If you don‚Äôt have patience, click here</button>
    </div>

    <div class="messages" id="messageBox" aria-live="polite">
      <div id="controlsInMessages" class="controls-in-messages" aria-hidden="false"></div>
    </div>

    <footer class="small">Tip: after finishing the flow you'll be prompted to download a response file you can share back with Pragadeesh.</footer>

    <div class="sparkles" id="sparklesArea" aria-hidden="true"></div>
  </main>

<script>
/* ========== Config (same as before) ========== */
const LINE_DELAY = 1800;
const INTRO_LINES = [
  "Happy Birthday, NIKITHA CATHRYN.N üå∏",
  "",
  "I didn‚Äôt forget your birthday ‚Äî I just didn‚Äôt want to consume your energy at the start of the day.",
  "I know you don‚Äôt have much patience, so I‚Äôm sending this at the end of the day, also I don‚Äôt want to start your day with annoyed",
  "",
  "Thank you for being in my life and for blowing everyone‚Äôs lights up.",
  "I hope you reached your 50 kg goal or are close to it.",
  "",
  "My wishes for you: your PhD, your job at FIA, your dream 911, and hitting the gym like you planned.",
  "",
  "You didn‚Äôt deserve what happened in the past ‚Äî focus on your future. You deserve the great, not just the good.",
  "",
  "Eat well, jojo well, stay hydrated, and please take care of yourself.",
  "",
  "Anyway, before you lose patience with me üòÇ I‚Äôll stop here.",
  "Do you still have patience to read just a few more lines?"
];
const FINAL_LINES = [
  "",
  "Thanks for being you‚Ä¶ and sorry for everything I did.",
  "Good night, Spice dreams, jojo well, NIKITHA (strong woman) üåô",
  "- Pragadeesh (aka Levi)"
];
/* ============================== */

const startBtn = document.getElementById('startCarBtn');
const skipBtn = document.getElementById('skipCarBtn');
const car = document.getElementById('car');
const titleOverlay = document.getElementById('titleOverlay');
const messageBox = document.getElementById('messageBox');
const controlsInMessages = document.getElementById('controlsInMessages');
const sparklesArea = document.getElementById('sparklesArea');

const responses = { started_at: new Date().toISOString(), answers: {} };

function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

/* sparkles */
function spawnSparkles(count=14){
  sparklesArea.innerHTML = '';
  for(let i=0;i<count;i++){
    const s = document.createElement('div'); s.className='spark';
    s.style.left = (5 + Math.random()*90) + '%';
    s.style.top = (20 + Math.random()*60) + '%';
    const dur = 6000 + Math.random()*7000;
    s.style.transition = `transform ${dur}ms linear, opacity ${dur/1.2}ms ease`;
    sparklesArea.appendChild(s);
    setTimeout(()=> {
      s.style.transform = `translateY(-${10 + Math.random()*40}px) translateX(${(Math.random()-0.5)*30}px)`;
      s.style.opacity = '0.08';
    }, 40 + Math.random()*800);
    setTimeout(()=> s.remove(), dur + 2000);
  }
}

/* reveal helper */
function revealLine(text){
  const el = document.createElement('div'); el.className='line'; el.innerHTML = text;
  messageBox.insertBefore(el, controlsInMessages);
  setTimeout(()=> el.classList.add('visible'), 120);
  messageBox.scrollTop = messageBox.scrollHeight;
}

/* message controls */
function clearMessageControls(){ controlsInMessages.innerHTML = ''; }

function createYesNoControls(callback){
  clearMessageControls();
  const container = document.createElement('div'); container.style.display='flex'; container.style.gap='10px'; container.style.justifyContent='center';
  const yes = document.createElement('button'); yes.className='btn primary'; yes.textContent='Yes';
  const no = document.createElement('button'); no.className='btn'; no.textContent='No';
  yes.onclick = ()=> { container.remove(); callback(true); };
  no.onclick = ()=> { container.remove(); callback(false); };
  container.appendChild(yes); container.appendChild(no);
  controlsInMessages.appendChild(container);
  yes.focus();
  return container;
}

function createRatingControl(callback){
  clearMessageControls();
  const container = document.createElement('div'); container.style.display='flex'; container.style.flexDirection='column'; container.style.gap='10px'; container.style.alignItems='center';
  const row = document.createElement('div'); row.style.display='flex'; row.style.gap='10px'; row.style.alignItems='center';
  const slider = document.createElement('input'); slider.type='range'; slider.min=1; slider.max=10; slider.value=8;
  slider.style.width = '170px';
  const badge = document.createElement('div'); badge.className='small'; badge.textContent=slider.value;
  slider.oninput = ()=> badge.textContent = slider.value;
  const ok = document.createElement('button'); ok.className='btn primary'; ok.textContent='Submit';
  ok.onclick = ()=> { container.remove(); callback(parseInt(slider.value,10)); };
  row.appendChild(slider); row.appendChild(badge);
  container.appendChild(row); container.appendChild(ok);
  controlsInMessages.appendChild(container);
  return container;
}

function createTextPrompt(callback){
  clearMessageControls();
  const container = document.createElement('div'); container.style.display='flex'; container.style.flexDirection='column'; container.style.gap='10px';
  const ta = document.createElement('textarea'); ta.className='wish'; ta.placeholder='Type your wish here (or leave empty to skip)';
  const row = document.createElement('div'); row.style.display='flex'; row.style.gap='10px'; row.style.justifyContent='center';
  const save = document.createElement('button'); save.className='btn primary'; save.textContent='Save';
  const skip = document.createElement('button'); skip.className='btn'; skip.textContent='Skip';
  save.onclick = ()=> { container.remove(); callback(ta.value.trim()); };
  skip.onclick = ()=> { container.remove(); callback(''); };
  row.appendChild(save); row.appendChild(skip);
  container.appendChild(ta); container.appendChild(row);
  controlsInMessages.appendChild(container);
  ta.focus();
  return container;
}

/* main flows */
async function startCarSequence(){
  startBtn.disabled = true; skipBtn.disabled = true;
  car.style.transform = 'scale(1.02)';
  await sleep(700);
  titleOverlay.style.opacity = '1'; titleOverlay.style.transform = 'translateY(0)';
  spawnSparkles(20);
  await sleep(900);
  document.getElementById('carWrap').classList.add('car-dim');
  messageBox.style.display = 'block';
  await sleep(500);
  runMessageFlow();
}

async function skipToMessages(){
  startBtn.disabled = true; skipBtn.disabled = true;
  titleOverlay.style.opacity = '1'; titleOverlay.style.transform = 'translateY(0)';
  document.getElementById('carWrap').classList.add('car-dim');
  messageBox.style.display = 'block';
  await sleep(350);
  runMessageFlow();
}

async function runMessageFlow(){
  revealLine("Hey, Nikitha‚Ä¶ are you ready for your birthday surprise?");
  createYesNoControls(async (ready)=>{
    responses.answers.ready = !!ready;
    if(!ready){
      revealLine("Alright üòÖ I won‚Äôt bother you. Still ‚Äî happy birthday, NIKITHA üíõ");
      await sleep(1000); showDownloadOption(); return;
    }
    revealLine("On a scale of 1 to 10, how good was your day?");
    createRatingControl(async (rating)=>{
      responses.answers.day_rating = rating;
      if(rating <= 5) revealLine('Hey ‚Äî bad days happen. You‚Äôre stronger than you think.');
      else revealLine("That‚Äôs good to hear ‚Äî glad your day was nice.");
      await sleep(1000);

      for(let i=0;i<INTRO_LINES.length;i++){
        revealLine(INTRO_LINES[i]);
        if(i % 4 === 0) spawnSparkles(6);
        await sleep(LINE_DELAY);
      }

      revealLine("Do you still have patience to read just a few more lines?");
      createYesNoControls(async (keep)=>{
        responses.answers.keep_reading = !!keep;
        if(!keep){
          revealLine('Okay, I get it. Happy birthday again, NIKITHA.');
          await sleep(1000); showDownloadOption(); return;
        }

        for(let i=0;i<FINAL_LINES.length;i++){
          revealLine(FINAL_LINES[i]); await sleep(LINE_DELAY);
        }

        // wish prompt shown once
        revealLine("If there‚Äôs any wish I can help with, tell me ‚Äî if not, that‚Äôs okay.");
        createTextPrompt(async (wish)=>{
          responses.answers.wish = wish || null;
          revealLine(wish ? "Got it ‚ù§Ô∏è I‚Äôll remember that." : "Alright üòä maybe next time.");
          revealLine("<div class='fromPrag'>üíõ From Pragadeesh aka Levi</div>");
          await sleep(1000);
          showDownloadOption();
        });
      });
    });
  });
}

/* =========== show download + direct send UI =========== */
function showDownloadOption(){
  clearMessageControls();
  responses.finished_at = new Date().toISOString();
  const ts = new Date().toISOString().replace(/[:.]/g,'').slice(0,15);
  const filename = `birthday_response_${ts}.json`;
  const blob = new Blob([JSON.stringify(responses, null, 2)], { type: 'application/json' });
  const fileUrl = URL.createObjectURL(blob);

  // download note + button
  const noteWrap = document.createElement('div');
  noteWrap.className = 'download-note';
  noteWrap.innerHTML = `
    <div>Please click the button below to download your response file.<br>
    After downloading, please send the file to Pragadeesh so he can have your response.</div>
    <button class="download-btn" id="downloadRespBtn">Download responses</button>
  `;
  messageBox.appendChild(noteWrap);

  // send panel (direct sending UI)
  const sendPanel = document.createElement('div');
  sendPanel.className = 'send-panel';
  sendPanel.innerHTML = `
    <div style="font-weight:700;color:#5b375e">Send directly to Pragadeesh</div>
    <div style="font-size:13px;color:var(--muted);margin-top:6px">Enter a phone number (with country code) or an email, or leave empty to choose on your device.</div>
    <div class="send-row">
      <input class="send-input" id="sendRecipient" placeholder="+919876543210 or pragadeesh@example.com" value="+918148494339" />
    </div>
    <textarea id="sendMessage" class="send-text">Hi Pragadeesh ‚Äî I downloaded my birthday response. I‚Äôve attached the file 'REPLACE_FILENAME' (please rename after download if needed). ‚Äî Nikitha</textarea>
    <div class="send-actions">
      <button id="whatsappSend" class="send-btn">Send by WhatsApp</button>
      <button id="emailSend" class="send-btn">Send by Email</button>
      <button id="copySend" class="send-btn">Copy message</button>
    </div>
    <div style="font-size:13px;color:var(--muted);margin-top:8px">Note: please attach the downloaded JSON file when sending. The app will open your chosen messenger ‚Äî you'll need to attach the file manually.</div>
  `;
  messageBox.appendChild(sendPanel);
  messageBox.scrollTop = messageBox.scrollHeight;

  // hookup buttons
  const dlBtn = noteWrap.querySelector('#downloadRespBtn');
  dlBtn.addEventListener('click', ()=> {
    const a = document.createElement('a'); a.href = fileUrl; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
    dlBtn.textContent = 'Downloaded ‚Äî thank you üíæ'; dlBtn.disabled = true;
  });

  const sendRecipient = sendPanel.querySelector('#sendRecipient');
  const sendMessage = sendPanel.querySelector('#sendMessage');
  // replace placeholder filename in message
  sendMessage.value = sendMessage.value.replace('REPLACE_FILENAME', filename);

  // WhatsApp: open API with encoded text. If recipient is phone, include it; otherwise open generic share
  const waBtn = sendPanel.querySelector('#whatsappSend');
  waBtn.addEventListener('click', ()=> {
    const recipient = sendRecipient.value.trim();
    const text = encodeURIComponent(sendMessage.value + "\n\n(Attach the downloaded file to this message.)");
    let url;
    if(recipient && /^[+0-9]{6,}$/.test(recipient.replace(/\s|-/g,''))){
      const phone = recipient.replace(/\s|\-/g,'');
      url = `https://api.whatsapp.com/send?phone=${encodeURIComponent(phone)}&text=${text}`;
    }else{
      url = `https://api.whatsapp.com/send?text=${text}`;
    }
    window.open(url, '_blank');
  });

  // Email: opens mail client with subject & body (can't attach file automatically)
  const emailBtn = sendPanel.querySelector('#emailSend');
  emailBtn.addEventListener('click', ()=> {
    const recipient = sendRecipient.value.trim();
    const subject = encodeURIComponent('Birthday response for Pragadeesh');
    const body = encodeURIComponent(sendMessage.value + "\n\n(Please attach the downloaded JSON file to this email.)");
    let mailto = 'mailto:';
    if(recipient && recipient.includes('@')) mailto += encodeURIComponent(recipient);
    mailto += `?subject=${subject}&body=${body}`;
    window.location.href = mailto;
  });

  // Copy message
  const copyBtn = sendPanel.querySelector('#copySend');
  copyBtn.addEventListener('click', ()=> {
    navigator.clipboard.writeText(sendMessage.value).then(()=> {
      copyBtn.textContent = 'Copied ‚úÖ';
      setTimeout(()=> copyBtn.textContent = 'Copy message', 1800);
    }).catch(()=> {
      alert('Copy failed ‚Äî please select and copy the message manually.');
    });
  });
}

/* events and init */
setInterval(()=> spawnSparkles(8), 7000);
startBtn.addEventListener('click', ()=> startCarSequence());
skipBtn.addEventListener('click', ()=> skipToMessages());
document.addEventListener('DOMContentLoaded', ()=> { spawnSparkles(12); startBtn.focus(); });
</script>
</body>
</html>
